services:
  website:
    container_name: website
    build:
      context: .
      dockerfile: ./website/Dockerfile
      args:
        - NODE_ENV=${NODE_ENV:-development}
        - BUILD_DIR=${BUILD_DIR:-/_build}
    tty: true
    environment:
      - NODE_ENV=${NODE_ENV:-development}
      - BUILD_DIR=${BUILD_DIR:-/_build}
      - PORT=${PORT:-3000}
      - GOOGLE_ANALYTICS_ID=${GOOGLE_ANALYTICS_ID}
      - GITHUB_TOKEN
      - NEXT_TELEMETRY_DISABLED=1
    volumes:
      - ./data:/data
      - ./website:/website  # Mount entire builder directory for hot reloading
      - ./website/node_modules:/website/node_modules
      - _build:/_build
      - _cache:/_cache
    ports:
      - "127.0.0.1:3000:3000"  # Next.js development server
    command: yarn dev

  docs:
    container_name: docs
    build:
      context: .
      dockerfile: ./docs/Dockerfile
    ports:
      - "127.0.0.1:${MKDOCS_PORT}:8000"
    tty: true
    environment:
      - GOOGLE_ANALYTICS_ID=${GOOGLE_ANALYTICS_ID}
      - CONFIG_FILE=/docs/src/mkdocs.yml
    command:
      serve --dev-addr 0.0.0.0:8000
    volumes:
      - ./_build:/_build
      - ./_cache:/_cache


volumes:
  _build:
    driver: local
  _cache:
    driver: local
