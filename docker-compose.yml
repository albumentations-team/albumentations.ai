services:
  website:
    container_name: website
    build:
      context: .
      dockerfile: ./website/Dockerfile
    tty: true
    environment:
      - NODE_ENV=development
      - PORT=3000
      - GITHUB_TOKEN
      - GOOGLE_ANALYTICS_ID
      - NEXT_TELEMETRY_DISABLED=1
    volumes:
      - ./data:/data
      - ./website:/website  # Mount entire builder directory for hot reloading
      - ./website/node_modules:/website/node_modules
      - _build:/_build
      - _cache:/_cache
    ports:
      - "127.0.0.1:3000:3000"  # Next.js development server
    command: run dev

  docs:
    container_name: docs
    build:
      context: .
      dockerfile: ./docs/Dockerfile
    ports:
      - "127.0.0.1:${MKDOCS_PORT}:8000"
    tty: true
    environment:
      - GOOGLE_ANALYTICS_ID
      - CONFIG_FILE=/docs/src/mkdocs.yml
    command:
      serve --dev-addr 0.0.0.0:8000
    volumes:
      - ${PWD}/_build:/_build      # Changed to use PWD
      - ${PWD}/_cache:/_cache      # Changed to use PWD


volumes:
  _build:
    driver: local
  _cache:
    driver: local
