
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Albumentations provides a comprehensive, high-performance framework for augmenting images to improve machine learning models. Ideal for computer vision applications, supporting a wide range of augmentations.">
      
      
      
        <link rel="canonical" href="https://albumentations.ai/docs/api_reference/augmentations/geometric/transforms/">
      
      
        <link rel="prev" href="../rotate/">
      
      
        <link rel="next" href="../../mixing/">
      
      
      <link rel="icon" href="../../../../images/logo.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.12">
    
    
      
        <title>Geometric transforms (augmentations.geometric.transforms) - Albumentations Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
    
      <link rel="stylesheet" href="../../../../css/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-DCXRDR9HJ0"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-DCXRDR9HJ0",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-DCXRDR9HJ0",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    





<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta property="og:title" content="Albumentations Documentation - Geometric transforms (augmentations.geometric.transforms)">
<meta property="og:description" content="Albumentations provides a comprehensive, high-performance framework for augmenting images to improve machine learning models. Ideal for computer vision applications, supporting a wide range of augmentations.">
<meta property="og:image" content="https://albumentations.ai/docs/images/albumentations_card.png">
<meta property="og:image:type" content="image/png">
<meta property="og:type" content="website">
<meta property="og:url" content="https://albumentations.ai/docs/api_reference/augmentations/geometric/transforms/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@albumentations">
<meta name="twitter:creator" content="@viglovikov">
<meta name="twitter:title" content="Albumentations Documentation - Geometric transforms (augmentations.geometric.transforms)">
<meta name="twitter:description" content="Albumentations provides a comprehensive, high-performance framework for augmenting images to improve machine learning models. Ideal for computer vision applications, supporting a wide range of augmentations.">
<meta name="twitter:image" content="https://albumentations.ai/docs/images/albumentations_card.png">
<meta name="description" content="Albumentations provides a comprehensive, high-performance framework for augmenting images to improve machine learning models. Ideal for computer vision applications, supporting a wide range of augmentations.">
<meta name="keywords"
  content="Albumentations, image augmentation, machine learning, computer vision, data augmentation, image processing, deep learning, AI, artificial intelligence, Python">


  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="white">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#geometric-transforms-augmentationsgeometrictransforms" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <header class="md-header" data-md-component="header">

  <nav class="md-header__inner md-grid" aria-label="header.title">
    <a href="../../../.." title="Albumentations Documentation"
      class="md-header__button md-logo" aria-label="Albumentations Documentation" data-md-component="logo">
      
  <img src="../../../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">

    </div>

    <div class="md-header-nav__title">
      <div class="header-menu-item">
        <a href="https://albumentations.ai">Home</a>
      </div>
      <div class="header-menu-item header-menu-item-selected">
        <a href="https://albumentations.ai/docs/">Documentation</a>
      </div>
      <div class="header-menu-item header-large-menu-item">
        <a href="https://albumentations.ai/whos_using">Who's using</a>
      </div>
      <div class="header-menu-item header-large-menu-item">
        <a href="https://demo.albumentations.ai" target="_blank">Demo</a>
      </div>
      <div class="header-menu-item header-large-menu-item">
        <a href="https://albumentations.ai/people">People</a>
      </div>
    </div>

    
<div class="md-search" data-md-component="search-query" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
    </form>
  </div>
</div>

    
    <div class="md-header__source">
      <a href="https://github.com/albumentations-team/albumentations" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    albumentations
  </div>
</a>
    </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          


<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
  <div class="md-sidebar__scrollwrap">
    <div class="md-sidebar__inner">
    </div>
  </div>
</div>


          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
<style>
  .highlight-ipynb {
    font-size: 0.7rem;
  }

  .jupyter-wrapper .jp-MarkdownOutput.jp-RenderedHTMLCommon {
    font-size: 0.8rem;
  }
</style>


<a href="https://github.com/albumentations-team/albumentations.ai/tree/main/mkdocs/src/docs/api_reference/augmentations/geometric/transforms.md"
  title="edit.link.title" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
</a>








<h1 id="geometric-transforms-augmentationsgeometrictransforms">Geometric transforms (augmentations.geometric.transforms)<a class="headerlink" href="#geometric-transforms-augmentationsgeometrictransforms" title="Permanent link">¶</a></h1>
<div class="doc doc-object doc-module">
<a id="albumentations.augmentations.geometric.transforms"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="Affine" id="albumentations.augmentations.geometric.transforms.Affine">
<code>class <strong>
Affine</strong></code>
<code>


    (scale=None, translate_percent=None, translate_px=None, rotate=None, shear=None, interpolation=1, mask_interpolation=0, cval=0, cval_mask=0, mode=0, fit_output=False, keep_ratio=False, rotate_method='largest_box', always_apply=False, p=0.5)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L613" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.Affine" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Augmentation to apply affine transformations to images.
This is mostly a wrapper around the corresponding classes and functions in OpenCV.</p>
<p>Affine transformations involve:</p>
<div class="codehilite"><pre><span></span><code>- Translation ("move" image on the x-/y-axis)
- Rotation
- Scaling ("zoom" in/out)
- Shear (move one side of the image, turning a square into a trapezoid)
</code></pre></div>
<p>All such transformations can create "new" pixels in the image without a defined content, e.g.
if the image is translated to the left, pixels are created on the right.
A method has to be defined to deal with these pixel values.
The parameters <code>cval</code> and <code>mode</code> of this class deal with this.</p>
<p>Some transformations involve interpolations between several pixels
of the input image to generate output pixel values. The parameters <code>interpolation</code> and
<code>mask_interpolation</code> deals with the method of interpolation used for this.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scale</code></td>
<td><code>number, tuple of number or dict</code></td>
<td><p>Scaling factor to use, where <code>1.0</code> denotes "no change" and
<code>0.5</code> is zoomed out to <code>50</code> percent of the original size.
    * If a single number, then that value will be used for all images.
    * If a tuple <code>(a, b)</code>, then a value will be uniformly sampled per image from the interval <code>[a, b]</code>.
      That the same range will be used for both x- and y-axis. To keep the aspect ratio, set
      <code>keep_ratio=True</code>, then the same value will be used for both x- and y-axis.
    * If a dictionary, then it is expected to have the keys <code>x</code> and/or <code>y</code>.
      Each of these keys can have the same values as described above.
      Using a dictionary allows to set different values for the two axis and sampling will then happen
      <em>independently</em> per axis, resulting in samples that differ between the axes. Note that when
      the <code>keep_ratio=True</code>, the x- and y-axis ranges should be the same.</p></td>
</tr>
<tr>
<td><code>translate_percent</code></td>
<td><code>None, number, tuple of number or dict</code></td>
<td><p>Translation as a fraction of the image height/width
(x-translation, y-translation), where <code>0</code> denotes "no change"
and <code>0.5</code> denotes "half of the axis size".
    * If <code>None</code> then equivalent to <code>0.0</code> unless <code>translate_px</code> has a value other than <code>None</code>.
    * If a single number, then that value will be used for all images.
    * If a tuple <code>(a, b)</code>, then a value will be uniformly sampled per image from the interval <code>[a, b]</code>.
      That sampled fraction value will be used identically for both x- and y-axis.
    * If a dictionary, then it is expected to have the keys <code>x</code> and/or <code>y</code>.
      Each of these keys can have the same values as described above.
      Using a dictionary allows to set different values for the two axis and sampling will then happen
      <em>independently</em> per axis, resulting in samples that differ between the axes.</p></td>
</tr>
<tr>
<td><code>translate_px</code></td>
<td><code>None, int, tuple of int or dict</code></td>
<td><p>Translation in pixels.
    * If <code>None</code> then equivalent to <code>0</code> unless <code>translate_percent</code> has a value other than <code>None</code>.
    * If a single int, then that value will be used for all images.
    * If a tuple <code>(a, b)</code>, then a value will be uniformly sampled per image from
      the discrete interval <code>[a..b]</code>. That number will be used identically for both x- and y-axis.
    * If a dictionary, then it is expected to have the keys <code>x</code> and/or <code>y</code>.
      Each of these keys can have the same values as described above.
      Using a dictionary allows to set different values for the two axis and sampling will then happen
      <em>independently</em> per axis, resulting in samples that differ between the axes.</p></td>
</tr>
<tr>
<td><code>rotate</code></td>
<td><code>number or tuple of number</code></td>
<td><p>Rotation in degrees (<strong>NOT</strong> radians), i.e. expected value range is
around <code>[-360, 360]</code>. Rotation happens around the <em>center</em> of the image,
not the top left corner as in some other frameworks.
    * If a number, then that value will be used for all images.
    * If a tuple <code>(a, b)</code>, then a value will be uniformly sampled per image from the interval <code>[a, b]</code>
      and used as the rotation value.</p></td>
</tr>
<tr>
<td><code>shear</code></td>
<td><code>number, tuple of number or dict</code></td>
<td><p>Shear in degrees (<strong>NOT</strong> radians), i.e. expected value range is
around <code>[-360, 360]</code>, with reasonable values being in the range of <code>[-45, 45]</code>.
    * If a number, then that value will be used for all images as
      the shear on the x-axis (no shear on the y-axis will be done).
    * If a tuple <code>(a, b)</code>, then two value will be uniformly sampled per image
      from the interval <code>[a, b]</code> and be used as the x- and y-shear value.
    * If a dictionary, then it is expected to have the keys <code>x</code> and/or <code>y</code>.
      Each of these keys can have the same values as described above.
      Using a dictionary allows to set different values for the two axis and sampling will then happen
      <em>independently</em> per axis, resulting in samples that differ between the axes.</p></td>
</tr>
<tr>
<td><code>interpolation</code></td>
<td><code>int</code></td>
<td><p>OpenCV interpolation flag.</p></td>
</tr>
<tr>
<td><code>mask_interpolation</code></td>
<td><code>int</code></td>
<td><p>OpenCV interpolation flag.</p></td>
</tr>
<tr>
<td><code>cval</code></td>
<td><code>number or sequence of number</code></td>
<td><p>The constant value to use when filling in newly created pixels.
(E.g. translating by 1px to the right will create a new 1px-wide column of pixels
on the left of the image).
The value is only used when <code>mode=constant</code>. The expected value range is <code>[0, 255]</code> for <code>uint8</code> images.</p></td>
</tr>
<tr>
<td><code>cval_mask</code></td>
<td><code>number or tuple of number</code></td>
<td><p>Same as cval but only for masks.</p></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>int</code></td>
<td><p>OpenCV border flag.</p></td>
</tr>
<tr>
<td><code>fit_output</code></td>
<td><code>bool</code></td>
<td><p>If True, the image plane size and position will be adjusted to tightly capture
the whole image after affine transformation (<code>translate_percent</code> and <code>translate_px</code> are ignored).
Otherwise (<code>False</code>),  parts of the transformed image may end up outside the image plane.
Fitting the output shape can be useful to avoid corners of the image being outside the image plane
after applying rotations. Default: False</p></td>
</tr>
<tr>
<td><code>keep_ratio</code></td>
<td><code>bool</code></td>
<td><p>When True, the original aspect ratio will be kept when the random scale is applied.
               Default: False.</p></td>
</tr>
<tr>
<td><code>rotate_method</code></td>
<td><code>str</code></td>
<td><p>rotation method used for the bounding boxes. Should be one of "largest_box" or
"ellipse"[1].
Default: "largest_box"</p></td>
</tr>
<tr>
<td><code>p</code></td>
<td><code>float</code></td>
<td><p>probability of applying the transform. Default: 0.5.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, keypoints, bboxes</p>
</div>
<p>Image types:
    uint8, float32</p>
<div class="admonition reference">
<p class="admonition-title">Reference</p>
<p>[1] <a href="https://arxiv.org/abs/2109.13488" target="_blank">https://arxiv.org/abs/2109.13488</a></p>
</div>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Affine</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Augmentation to apply affine transformations to images.</span>
<span class="sd">    This is mostly a wrapper around the corresponding classes and functions in OpenCV.</span>

<span class="sd">    Affine transformations involve:</span>

<span class="sd">        - Translation ("move" image on the x-/y-axis)</span>
<span class="sd">        - Rotation</span>
<span class="sd">        - Scaling ("zoom" in/out)</span>
<span class="sd">        - Shear (move one side of the image, turning a square into a trapezoid)</span>

<span class="sd">    All such transformations can create "new" pixels in the image without a defined content, e.g.</span>
<span class="sd">    if the image is translated to the left, pixels are created on the right.</span>
<span class="sd">    A method has to be defined to deal with these pixel values.</span>
<span class="sd">    The parameters `cval` and `mode` of this class deal with this.</span>

<span class="sd">    Some transformations involve interpolations between several pixels</span>
<span class="sd">    of the input image to generate output pixel values. The parameters `interpolation` and</span>
<span class="sd">    `mask_interpolation` deals with the method of interpolation used for this.</span>

<span class="sd">    Args:</span>
<span class="sd">        scale (number, tuple of number or dict): Scaling factor to use, where ``1.0`` denotes "no change" and</span>
<span class="sd">            ``0.5`` is zoomed out to ``50`` percent of the original size.</span>
<span class="sd">                * If a single number, then that value will be used for all images.</span>
<span class="sd">                * If a tuple ``(a, b)``, then a value will be uniformly sampled per image from the interval ``[a, b]``.</span>
<span class="sd">                  That the same range will be used for both x- and y-axis. To keep the aspect ratio, set</span>
<span class="sd">                  ``keep_ratio=True``, then the same value will be used for both x- and y-axis.</span>
<span class="sd">                * If a dictionary, then it is expected to have the keys ``x`` and/or ``y``.</span>
<span class="sd">                  Each of these keys can have the same values as described above.</span>
<span class="sd">                  Using a dictionary allows to set different values for the two axis and sampling will then happen</span>
<span class="sd">                  *independently* per axis, resulting in samples that differ between the axes. Note that when</span>
<span class="sd">                  the ``keep_ratio=True``, the x- and y-axis ranges should be the same.</span>
<span class="sd">        translate_percent (None, number, tuple of number or dict): Translation as a fraction of the image height/width</span>
<span class="sd">            (x-translation, y-translation), where ``0`` denotes "no change"</span>
<span class="sd">            and ``0.5`` denotes "half of the axis size".</span>
<span class="sd">                * If ``None`` then equivalent to ``0.0`` unless `translate_px` has a value other than ``None``.</span>
<span class="sd">                * If a single number, then that value will be used for all images.</span>
<span class="sd">                * If a tuple ``(a, b)``, then a value will be uniformly sampled per image from the interval ``[a, b]``.</span>
<span class="sd">                  That sampled fraction value will be used identically for both x- and y-axis.</span>
<span class="sd">                * If a dictionary, then it is expected to have the keys ``x`` and/or ``y``.</span>
<span class="sd">                  Each of these keys can have the same values as described above.</span>
<span class="sd">                  Using a dictionary allows to set different values for the two axis and sampling will then happen</span>
<span class="sd">                  *independently* per axis, resulting in samples that differ between the axes.</span>
<span class="sd">        translate_px (None, int, tuple of int or dict): Translation in pixels.</span>
<span class="sd">                * If ``None`` then equivalent to ``0`` unless `translate_percent` has a value other than ``None``.</span>
<span class="sd">                * If a single int, then that value will be used for all images.</span>
<span class="sd">                * If a tuple ``(a, b)``, then a value will be uniformly sampled per image from</span>
<span class="sd">                  the discrete interval ``[a..b]``. That number will be used identically for both x- and y-axis.</span>
<span class="sd">                * If a dictionary, then it is expected to have the keys ``x`` and/or ``y``.</span>
<span class="sd">                  Each of these keys can have the same values as described above.</span>
<span class="sd">                  Using a dictionary allows to set different values for the two axis and sampling will then happen</span>
<span class="sd">                  *independently* per axis, resulting in samples that differ between the axes.</span>
<span class="sd">        rotate (number or tuple of number): Rotation in degrees (**NOT** radians), i.e. expected value range is</span>
<span class="sd">            around ``[-360, 360]``. Rotation happens around the *center* of the image,</span>
<span class="sd">            not the top left corner as in some other frameworks.</span>
<span class="sd">                * If a number, then that value will be used for all images.</span>
<span class="sd">                * If a tuple ``(a, b)``, then a value will be uniformly sampled per image from the interval ``[a, b]``</span>
<span class="sd">                  and used as the rotation value.</span>
<span class="sd">        shear (number, tuple of number or dict): Shear in degrees (**NOT** radians), i.e. expected value range is</span>
<span class="sd">            around ``[-360, 360]``, with reasonable values being in the range of ``[-45, 45]``.</span>
<span class="sd">                * If a number, then that value will be used for all images as</span>
<span class="sd">                  the shear on the x-axis (no shear on the y-axis will be done).</span>
<span class="sd">                * If a tuple ``(a, b)``, then two value will be uniformly sampled per image</span>
<span class="sd">                  from the interval ``[a, b]`` and be used as the x- and y-shear value.</span>
<span class="sd">                * If a dictionary, then it is expected to have the keys ``x`` and/or ``y``.</span>
<span class="sd">                  Each of these keys can have the same values as described above.</span>
<span class="sd">                  Using a dictionary allows to set different values for the two axis and sampling will then happen</span>
<span class="sd">                  *independently* per axis, resulting in samples that differ between the axes.</span>
<span class="sd">        interpolation (int): OpenCV interpolation flag.</span>
<span class="sd">        mask_interpolation (int): OpenCV interpolation flag.</span>
<span class="sd">        cval (number or sequence of number): The constant value to use when filling in newly created pixels.</span>
<span class="sd">            (E.g. translating by 1px to the right will create a new 1px-wide column of pixels</span>
<span class="sd">            on the left of the image).</span>
<span class="sd">            The value is only used when `mode=constant`. The expected value range is ``[0, 255]`` for ``uint8`` images.</span>
<span class="sd">        cval_mask (number or tuple of number): Same as cval but only for masks.</span>
<span class="sd">        mode (int): OpenCV border flag.</span>
<span class="sd">        fit_output (bool): If True, the image plane size and position will be adjusted to tightly capture</span>
<span class="sd">            the whole image after affine transformation (`translate_percent` and `translate_px` are ignored).</span>
<span class="sd">            Otherwise (``False``),  parts of the transformed image may end up outside the image plane.</span>
<span class="sd">            Fitting the output shape can be useful to avoid corners of the image being outside the image plane</span>
<span class="sd">            after applying rotations. Default: False</span>
<span class="sd">        keep_ratio (bool): When True, the original aspect ratio will be kept when the random scale is applied.</span>
<span class="sd">                           Default: False.</span>
<span class="sd">        rotate_method (str): rotation method used for the bounding boxes. Should be one of "largest_box" or</span>
<span class="sd">            "ellipse"[1].</span>
<span class="sd">            Default: "largest_box"</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, keypoints, bboxes</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    Reference:</span>
<span class="sd">        [1] https://arxiv.org/abs/2109.13488</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ScaleFloatType</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">translate_percent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">translate_px</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rotate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScaleFloatType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">shear</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">ScaleFloatType</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="n">mask_interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span>
        <span class="n">cval</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cval_mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span>
        <span class="n">fit_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">keep_ratio</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">rotate_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"largest_box"</span><span class="p">,</span>
        <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="o">=</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">scale</span><span class="p">,</span> <span class="n">translate_percent</span><span class="p">,</span> <span class="n">translate_px</span><span class="p">,</span> <span class="n">rotate</span><span class="p">,</span> <span class="n">shear</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">):</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"x"</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span> <span class="s2">"y"</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)}</span>
            <span class="n">translate_percent</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"x"</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="s2">"y"</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)}</span>
            <span class="n">rotate</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
            <span class="n">shear</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"x"</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="s2">"y"</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span> <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">1.0</span>
            <span class="n">rotate</span> <span class="o">=</span> <span class="n">rotate</span> <span class="k">if</span> <span class="n">rotate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">shear</span> <span class="o">=</span> <span class="n">shear</span> <span class="k">if</span> <span class="n">shear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_interpolation</span> <span class="o">=</span> <span class="n">mask_interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cval</span> <span class="o">=</span> <span class="n">cval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cval_mask</span> <span class="o">=</span> <span class="n">cval_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_dict_arg</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="s2">"scale"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translate_percent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_translate_arg</span><span class="p">(</span><span class="n">translate_px</span><span class="p">,</span> <span class="n">translate_percent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">rotate</span><span class="p">,</span> <span class="n">rotate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_output</span> <span class="o">=</span> <span class="n">fit_output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_dict_arg</span><span class="p">(</span><span class="n">shear</span><span class="p">,</span> <span class="s2">"shear"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_ratio</span> <span class="o">=</span> <span class="n">keep_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_method</span> <span class="o">=</span> <span class="n">rotate_method</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_ratio</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"When keep_ratio is True, the x and y scale range should be identical. got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">"interpolation"</span><span class="p">,</span>
            <span class="s2">"mask_interpolation"</span><span class="p">,</span>
            <span class="s2">"cval"</span><span class="p">,</span>
            <span class="s2">"mode"</span><span class="p">,</span>
            <span class="s2">"scale"</span><span class="p">,</span>
            <span class="s2">"translate_percent"</span><span class="p">,</span>
            <span class="s2">"translate_px"</span><span class="p">,</span>
            <span class="s2">"rotate"</span><span class="p">,</span>
            <span class="s2">"fit_output"</span><span class="p">,</span>
            <span class="s2">"shear"</span><span class="p">,</span>
            <span class="s2">"cval_mask"</span><span class="p">,</span>
            <span class="s2">"keep_ratio"</span><span class="p">,</span>
            <span class="s2">"rotate_method"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_handle_dict_arg</span><span class="p">(</span>
        <span class="n">val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">"x"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">and</span> <span class="s2">"y"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'Expected </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> dictionary to contain at least key "x" or '</span> <span class="s1">'key "y". Found neither of them.'</span>
                <span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">"x"</span><span class="p">:</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="s2">"y"</span><span class="p">:</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)}</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">"x"</span><span class="p">:</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span> <span class="s2">"y"</span><span class="p">:</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span><span class="p">)}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_handle_translate_arg</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">translate_px</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
        <span class="n">translate_percent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">translate_percent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">translate_px</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">translate_px</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">translate_percent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">translate_px</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Expected either translate_percent or translate_px to be "</span> <span class="s2">"provided, "</span> <span class="s2">"but neither of them was."</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">translate_percent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># translate by percent</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_handle_dict_arg</span><span class="p">(</span><span class="n">translate_percent</span><span class="p">,</span> <span class="s2">"translate_percent"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">translate_px</span>

        <span class="k">if</span> <span class="n">translate_px</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"translate_px is None."</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># translate by pixels</span>
        <span class="k">return</span> <span class="n">translate_percent</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_handle_dict_arg</span><span class="p">(</span><span class="n">translate_px</span><span class="p">,</span> <span class="s2">"translate_px"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">ProjectiveTransform</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">warp_affine</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="n">matrix</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">),</span>
            <span class="n">cval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cval</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">output_shape</span><span class="o">=</span><span class="n">output_shape</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">ProjectiveTransform</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">warp_affine</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="n">matrix</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_interpolation</span><span class="p">,</span>
            <span class="n">cval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cval_mask</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">output_shape</span><span class="o">=</span><span class="n">output_shape</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">ProjectiveTransform</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">output_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">bbox_affine</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_method</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">output_shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">ProjectiveTransform</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeypointInternalType</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Expected scale to be provided, but got None."</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Expected matrix to be provided, but got None."</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">keypoint_affine</span><span class="p">(</span><span class="n">keypoint</span><span class="p">,</span> <span class="n">matrix</span><span class="o">=</span><span class="n">matrix</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targets_as_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">"image"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_params_dependent_on_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"image"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">translate</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_px</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_px</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_percent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_percent</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">translate</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="n">translate</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span>
            <span class="n">translate</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]</span> <span class="o">=</span> <span class="n">translate</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">translate</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"x"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># Look to issue https://github.com/albumentations-team/albumentations/issues/1079</span>
        <span class="n">shear</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="o">-</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shear</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_ratio</span><span class="p">:</span>
            <span class="n">scale</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span>

        <span class="c1"># Look to issue https://github.com/albumentations-team/albumentations/issues/1079</span>
        <span class="n">rotate</span> <span class="o">=</span> <span class="o">-</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">)</span>

        <span class="c1"># for images we use additional shifts of (0.5, 0.5) as otherwise</span>
        <span class="c1"># we get an ugly black border for 90deg rotations</span>
        <span class="n">shift_x</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span>
        <span class="n">shift_y</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span>

        <span class="n">matrix_to_topleft</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">SimilarityTransform</span><span class="p">(</span><span class="n">translation</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">shift_x</span><span class="p">,</span> <span class="o">-</span><span class="n">shift_y</span><span class="p">])</span>
        <span class="n">matrix_shear_y_rot</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">AffineTransform</span><span class="p">(</span><span class="n">rotation</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">matrix_shear_y</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">AffineTransform</span><span class="p">(</span><span class="n">shear</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">shear</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]))</span>
        <span class="n">matrix_shear_y_rot_inv</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">AffineTransform</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">matrix_transforms</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">AffineTransform</span><span class="p">(</span>
            <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="n">scale</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">scale</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]),</span>
            <span class="n">translation</span><span class="o">=</span><span class="p">(</span><span class="n">translate</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">translate</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]),</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">rotate</span><span class="p">),</span>
            <span class="n">shear</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">shear</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="n">matrix_to_center</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">SimilarityTransform</span><span class="p">(</span><span class="n">translation</span><span class="o">=</span><span class="p">[</span><span class="n">shift_x</span><span class="p">,</span> <span class="n">shift_y</span><span class="p">])</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">matrix_to_topleft</span>
            <span class="o">+</span> <span class="n">matrix_shear_y_rot</span>
            <span class="o">+</span> <span class="n">matrix_shear_y</span>
            <span class="o">+</span> <span class="n">matrix_shear_y_rot_inv</span>
            <span class="o">+</span> <span class="n">matrix_transforms</span>
            <span class="o">+</span> <span class="n">matrix_to_center</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_output</span><span class="p">:</span>
            <span class="n">matrix</span><span class="p">,</span> <span class="n">output_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_affine_warp_output_shape</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">"image"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_shape</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"image"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"rotate"</span><span class="p">:</span> <span class="n">rotate</span><span class="p">,</span>
            <span class="s2">"scale"</span><span class="p">:</span> <span class="n">scale</span><span class="p">,</span>
            <span class="s2">"matrix"</span><span class="p">:</span> <span class="n">matrix</span><span class="p">,</span>
            <span class="s2">"output_shape"</span><span class="p">:</span> <span class="n">output_shape</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compute_affine_warp_output_shape</span><span class="p">(</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">ProjectiveTransform</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">ProjectiveTransform</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">input_shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">height</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">width</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">input_shape</span>

        <span class="c1"># determine shape of output image</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span>
        <span class="n">minc</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">minr</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">maxc</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">maxr</span> <span class="o">=</span> <span class="n">corners</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">out_height</span> <span class="o">=</span> <span class="n">maxr</span> <span class="o">-</span> <span class="n">minr</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">out_width</span> <span class="o">=</span> <span class="n">maxc</span> <span class="o">-</span> <span class="n">minc</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span> <span class="o">==</span> <span class="n">THREE</span><span class="p">:</span>
            <span class="n">output_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">out_height</span><span class="p">,</span> <span class="n">out_width</span><span class="p">))</span>
        <span class="n">output_shape_tuple</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">output_shape</span><span class="o">.</span><span class="n">tolist</span><span class="p">()])</span>
        <span class="c1"># fit output image in new shape</span>
        <span class="n">translation</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">minc</span><span class="p">,</span> <span class="o">-</span><span class="n">minr</span><span class="p">)</span>
        <span class="n">matrix_to_fit</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">SimilarityTransform</span><span class="p">(</span><span class="n">translation</span><span class="o">=</span><span class="n">translation</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span> <span class="o">+</span> <span class="n">matrix_to_fit</span>
        <span class="k">return</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">output_shape_tuple</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="ElasticTransform" id="albumentations.augmentations.geometric.transforms.ElasticTransform">
<code>class <strong>
ElasticTransform</strong></code>
<code>


    (alpha=1, sigma=50, alpha_affine=50, interpolation=1, border_mode=4, value=None, mask_value=None, always_apply=False, approximate=False, same_dxdy=False, p=0.5)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L214" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.ElasticTransform" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Elastic deformation of images as described in [Simard2003]_ (with modifications).
Based on <a href="https://gist.github.com/ernestum/601cdf56d2b424757de5" target="_blank">https://gist.github.com/ernestum/601cdf56d2b424757de5</a></p>
<p>.. [Simard2003] Simard, Steinkraus and Platt, "Best Practices for
     Convolutional Neural Networks applied to Visual Document Analysis", in
     Proc. of the International Conference on Document Analysis and
     Recognition, 2003.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>alpha</code></td>
<td><code>float</code></td>
<td></td>
</tr>
<tr>
<td><code>sigma</code></td>
<td><code>float</code></td>
<td><p>Gaussian filter parameter.</p></td>
</tr>
<tr>
<td><code>alpha_affine</code></td>
<td><code>float</code></td>
<td><p>The range will be (-alpha_affine, alpha_affine)</p></td>
</tr>
<tr>
<td><code>interpolation</code></td>
<td><code>OpenCV flag</code></td>
<td><p>flag that is used to specify the interpolation algorithm. Should be one of:
cv2.INTER_NEAREST, cv2.INTER_LINEAR, cv2.INTER_CUBIC, cv2.INTER_AREA, cv2.INTER_LANCZOS4.
Default: cv2.INTER_LINEAR.</p></td>
</tr>
<tr>
<td><code>border_mode</code></td>
<td><code>OpenCV flag</code></td>
<td><p>flag that is used to specify the pixel extrapolation method. Should be one of:
cv2.BORDER_CONSTANT, cv2.BORDER_REPLICATE, cv2.BORDER_REFLECT, cv2.BORDER_WRAP, cv2.BORDER_REFLECT_101.
Default: cv2.BORDER_REFLECT_101</p></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>int, float, list of ints, list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT.</p></td>
</tr>
<tr>
<td><code>mask_value</code></td>
<td><code>int, float,
        list of ints,
        list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT applied for masks.</p></td>
</tr>
<tr>
<td><code>approximate</code></td>
<td><code>boolean</code></td>
<td><p>Whether to smooth displacement map with fixed kernel size.
                   Enabling this option gives ~2X speedup on large images.</p></td>
</tr>
<tr>
<td><code>same_dxdy</code></td>
<td><code>boolean</code></td>
<td><p>Whether to use same random generated shift for x and y.
                 Enabling this option gives ~2X speedup.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, bboxes</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ElasticTransform</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Elastic deformation of images as described in [Simard2003]_ (with modifications).</span>
<span class="sd">    Based on https://gist.github.com/ernestum/601cdf56d2b424757de5</span>

<span class="sd">    .. [Simard2003] Simard, Steinkraus and Platt, "Best Practices for</span>
<span class="sd">         Convolutional Neural Networks applied to Visual Document Analysis", in</span>
<span class="sd">         Proc. of the International Conference on Document Analysis and</span>
<span class="sd">         Recognition, 2003.</span>

<span class="sd">    Args:</span>
<span class="sd">        alpha (float):</span>
<span class="sd">        sigma (float): Gaussian filter parameter.</span>
<span class="sd">        alpha_affine (float): The range will be (-alpha_affine, alpha_affine)</span>
<span class="sd">        interpolation (OpenCV flag): flag that is used to specify the interpolation algorithm. Should be one of:</span>
<span class="sd">            cv2.INTER_NEAREST, cv2.INTER_LINEAR, cv2.INTER_CUBIC, cv2.INTER_AREA, cv2.INTER_LANCZOS4.</span>
<span class="sd">            Default: cv2.INTER_LINEAR.</span>
<span class="sd">        border_mode (OpenCV flag): flag that is used to specify the pixel extrapolation method. Should be one of:</span>
<span class="sd">            cv2.BORDER_CONSTANT, cv2.BORDER_REPLICATE, cv2.BORDER_REFLECT, cv2.BORDER_WRAP, cv2.BORDER_REFLECT_101.</span>
<span class="sd">            Default: cv2.BORDER_REFLECT_101</span>
<span class="sd">        value (int, float, list of ints, list of float): padding value if border_mode is cv2.BORDER_CONSTANT.</span>
<span class="sd">        mask_value (int, float,</span>
<span class="sd">                    list of ints,</span>
<span class="sd">                    list of float): padding value if border_mode is cv2.BORDER_CONSTANT applied for masks.</span>
<span class="sd">        approximate (boolean): Whether to smooth displacement map with fixed kernel size.</span>
<span class="sd">                               Enabling this option gives ~2X speedup on large images.</span>
<span class="sd">        same_dxdy (boolean): Whether to use same random generated shift for x and y.</span>
<span class="sd">                             Enabling this option gives ~2X speedup.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, bboxes</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">alpha_affine</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="n">border_mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REFLECT_101</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">approximate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">same_dxdy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_affine</span> <span class="o">=</span> <span class="n">alpha_affine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span> <span class="o">=</span> <span class="n">border_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span> <span class="o">=</span> <span class="n">mask_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">approximate</span> <span class="o">=</span> <span class="n">approximate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">same_dxdy</span> <span class="o">=</span> <span class="n">same_dxdy</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">elastic_transform</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_affine</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">random_state</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">approximate</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">same_dxdy</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">elastic_transform</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_affine</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">random_state</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">approximate</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">same_dxdy</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span> <span class="n">random_state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"rows"</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">"cols"</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">bbox_denorm</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">denormalize_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">bbox_denorm</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_min</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_min</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_max</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_max</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">y_min</span><span class="p">:</span><span class="n">y_max</span><span class="p">,</span> <span class="n">x_min</span><span class="p">:</span><span class="n">x_max</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">elastic_transform</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_affine</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">random_state</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">approximate</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">bbox_returned</span> <span class="o">=</span> <span class="n">bbox_from_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">BoxInternalType</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize_bbox</span><span class="p">(</span><span class="n">bbox_returned</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">"random_state"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">"alpha"</span><span class="p">,</span>
            <span class="s2">"sigma"</span><span class="p">,</span>
            <span class="s2">"alpha_affine"</span><span class="p">,</span>
            <span class="s2">"interpolation"</span><span class="p">,</span>
            <span class="s2">"border_mode"</span><span class="p">,</span>
            <span class="s2">"value"</span><span class="p">,</span>
            <span class="s2">"mask_value"</span><span class="p">,</span>
            <span class="s2">"approximate"</span><span class="p">,</span>
            <span class="s2">"same_dxdy"</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="Flip" id="albumentations.augmentations.geometric.transforms.Flip">
<code>class <strong>
Flip</strong></code>
<code>
</code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L1378" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.Flip" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Flip the input either horizontally, vertically or both horizontally and vertically.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>p</code></td>
<td><code>float</code></td>
<td><p>probability of applying the transform. Default: 0.5.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, bboxes, keypoints</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Flip</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Flip the input either horizontally, vertically or both horizontally and vertically.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, bboxes, keypoints</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Args:</span>
<span class="sd">        d (int): code that specifies how to flip the input. 0 for vertical flipping, 1 for horizontal flipping,</span>
<span class="sd">                -1 for both vertical and horizontal flipping (which is also could be seen as rotating the input by</span>
<span class="sd">                180 degrees).</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="c1"># Random int in the range [-1, 1]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">"d"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">bbox_flip</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeypointInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">keypoint_flip</span><span class="p">(</span><span class="n">keypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[()]:</span>
        <span class="k">return</span> <span class="p">()</span>
</code></pre></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="albumentations.augmentations.geometric.transforms.Flip.apply">
<code class="language-python"><span class="n">apply</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span></code>
<a class="headerlink" href="#albumentations.augmentations.geometric.transforms.Flip.apply" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>d (int): code that specifies how to flip the input. 0 for vertical flipping, 1 for horizontal flipping,
        -1 for both vertical and horizontal flipping (which is also could be seen as rotating the input by
        180 degrees).</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Args:</span>
<span class="sd">    d (int): code that specifies how to flip the input. 0 for vertical flipping, 1 for horizontal flipping,</span>
<span class="sd">            -1 for both vertical and horizontal flipping (which is also could be seen as rotating the input by</span>
<span class="sd">            180 degrees).</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">random_flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</code></pre></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="GridDistortion" id="albumentations.augmentations.geometric.transforms.GridDistortion">
<code>class <strong>
GridDistortion</strong></code>
<code>


    (num_steps=5, distort_limit=0.3, interpolation=1, border_mode=4, value=None, mask_value=None, normalized=False, always_apply=False, p=0.5)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L1551" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.GridDistortion" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>num_steps</code></td>
<td><code>int</code></td>
<td><p>count of grid cells on each side.</p></td>
</tr>
<tr>
<td><code>distort_limit</code></td>
<td><code>float, (float, float</code></td>
<td><p>If distort_limit is a single float, the range
will be (-distort_limit, distort_limit). Default: (-0.03, 0.03).</p></td>
</tr>
<tr>
<td><code>interpolation</code></td>
<td><code>OpenCV flag</code></td>
<td><p>flag that is used to specify the interpolation algorithm. Should be one of:
cv2.INTER_NEAREST, cv2.INTER_LINEAR, cv2.INTER_CUBIC, cv2.INTER_AREA, cv2.INTER_LANCZOS4.
Default: cv2.INTER_LINEAR.</p></td>
</tr>
<tr>
<td><code>border_mode</code></td>
<td><code>OpenCV flag</code></td>
<td><p>flag that is used to specify the pixel extrapolation method. Should be one of:
cv2.BORDER_CONSTANT, cv2.BORDER_REPLICATE, cv2.BORDER_REFLECT, cv2.BORDER_WRAP, cv2.BORDER_REFLECT_101.
Default: cv2.BORDER_REFLECT_101</p></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>int, float, list of ints, list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT.</p></td>
</tr>
<tr>
<td><code>mask_value</code></td>
<td><code>int, float,
        list of ints,
        list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT applied for masks.</p></td>
</tr>
<tr>
<td><code>normalized</code></td>
<td><code>bool</code></td>
<td><p>if true, distortion will be normalized to do not go outside the image. Default: False
See for more information: <a href="https://github.com/albumentations-team/albumentations/pull/722" target="_blank">https://github.com/albumentations-team/albumentations/pull/722</a></p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, bboxes</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">GridDistortion</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Args:</span>
<span class="sd">        num_steps (int): count of grid cells on each side.</span>
<span class="sd">        distort_limit (float, (float, float)): If distort_limit is a single float, the range</span>
<span class="sd">            will be (-distort_limit, distort_limit). Default: (-0.03, 0.03).</span>
<span class="sd">        interpolation (OpenCV flag): flag that is used to specify the interpolation algorithm. Should be one of:</span>
<span class="sd">            cv2.INTER_NEAREST, cv2.INTER_LINEAR, cv2.INTER_CUBIC, cv2.INTER_AREA, cv2.INTER_LANCZOS4.</span>
<span class="sd">            Default: cv2.INTER_LINEAR.</span>
<span class="sd">        border_mode (OpenCV flag): flag that is used to specify the pixel extrapolation method. Should be one of:</span>
<span class="sd">            cv2.BORDER_CONSTANT, cv2.BORDER_REPLICATE, cv2.BORDER_REFLECT, cv2.BORDER_WRAP, cv2.BORDER_REFLECT_101.</span>
<span class="sd">            Default: cv2.BORDER_REFLECT_101</span>
<span class="sd">        value (int, float, list of ints, list of float): padding value if border_mode is cv2.BORDER_CONSTANT.</span>
<span class="sd">        mask_value (int, float,</span>
<span class="sd">                    list of ints,</span>
<span class="sd">                    list of float): padding value if border_mode is cv2.BORDER_CONSTANT applied for masks.</span>
<span class="sd">        normalized (bool): if true, distortion will be normalized to do not go outside the image. Default: False</span>
<span class="sd">            See for more information: https://github.com/albumentations-team/albumentations/pull/722</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, bboxes</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">distort_limit</span><span class="p">:</span> <span class="n">ScaleFloatType</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="n">border_mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REFLECT_101</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageColorType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageColorType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">normalized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="o">=</span> <span class="n">num_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distort_limit</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">distort_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span> <span class="o">=</span> <span class="n">border_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span> <span class="o">=</span> <span class="n">mask_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalized</span> <span class="o">=</span> <span class="n">normalized</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">stepsx</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[()]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">stepsy</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[()]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_distortion</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span><span class="p">,</span> <span class="n">stepsx</span><span class="p">,</span> <span class="n">stepsy</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">stepsx</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[()]</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">stepsy</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[()]</span> <span class="o">=</span> <span class="p">(),</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_distortion</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span><span class="p">,</span> <span class="n">stepsx</span><span class="p">,</span> <span class="n">stepsy</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span> <span class="n">stepsx</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[()]</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">stepsy</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[()]</span> <span class="o">=</span> <span class="p">(),</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"rows"</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">"cols"</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">bbox_denorm</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">denormalize_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">bbox_denorm</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_min</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_min</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_max</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_max</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">y_min</span><span class="p">:</span><span class="n">y_max</span><span class="p">,</span> <span class="n">x_min</span><span class="p">:</span><span class="n">x_max</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_distortion</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span><span class="p">,</span> <span class="n">stepsx</span><span class="p">,</span> <span class="n">stepsy</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span>
        <span class="p">)</span>
        <span class="n">bbox_returned</span> <span class="o">=</span> <span class="n">bbox_from_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">BoxInternalType</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize_bbox</span><span class="p">(</span><span class="n">bbox_returned</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">xsteps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">ysteps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="c1"># compensate for smaller last steps in source image.</span>
        <span class="n">x_step</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span>
        <span class="n">last_x_step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_step</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="o">*</span> <span class="n">x_step</span><span class="p">)</span>
        <span class="n">xsteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">last_x_step</span> <span class="o">/</span> <span class="n">x_step</span>

        <span class="n">y_step</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span>
        <span class="n">last_y_step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_step</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="o">*</span> <span class="n">y_step</span><span class="p">)</span>
        <span class="n">ysteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">last_y_step</span> <span class="o">/</span> <span class="n">y_step</span>

        <span class="c1"># now normalize such that distortion never leaves image bounds.</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span><span class="p">)</span>
        <span class="n">ty</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span><span class="p">)</span>
        <span class="n">xsteps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xsteps</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tx</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xsteps</span><span class="p">))</span>
        <span class="n">ysteps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ysteps</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">ty</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ysteps</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">"stepsx"</span><span class="p">:</span> <span class="n">xsteps</span><span class="p">,</span> <span class="s2">"stepsy"</span><span class="p">:</span> <span class="n">ysteps</span><span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targets_as_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">"image"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_params_dependent_on_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"image"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">stepsx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distort_limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">distort_limit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">stepsy</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distort_limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">distort_limit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">stepsx</span><span class="p">,</span> <span class="n">stepsy</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">"stepsx"</span><span class="p">:</span> <span class="n">stepsx</span><span class="p">,</span> <span class="s2">"stepsy"</span><span class="p">:</span> <span class="n">stepsy</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">"num_steps"</span><span class="p">,</span> <span class="s2">"distort_limit"</span><span class="p">,</span> <span class="s2">"interpolation"</span><span class="p">,</span> <span class="s2">"border_mode"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">,</span> <span class="s2">"mask_value"</span><span class="p">,</span> <span class="s2">"normalized"</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="HorizontalFlip" id="albumentations.augmentations.geometric.transforms.HorizontalFlip">
<code>class <strong>
HorizontalFlip</strong></code>
<code>
</code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L1344" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.HorizontalFlip" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Flip the input horizontally around the y-axis.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>p</code></td>
<td><code>float</code></td>
<td><p>probability of applying the transform. Default: 0.5.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, bboxes, keypoints</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HorizontalFlip</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Flip the input horizontally around the y-axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, bboxes, keypoints</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">THREE</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="c1"># Opencv is faster than numpy only in case of</span>
            <span class="c1"># non-gray scale 8bits images</span>
            <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">hflip_cv2</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">hflip</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">bbox_hflip</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeypointInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">keypoint_hflip</span><span class="p">(</span><span class="n">keypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[()]:</span>
        <span class="k">return</span> <span class="p">()</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="OpticalDistortion" id="albumentations.augmentations.geometric.transforms.OpticalDistortion">
<code>class <strong>
OpticalDistortion</strong></code>
<code>


    (distort_limit=0.05, shift_limit=0.05, interpolation=1, border_mode=4, value=None, mask_value=None, always_apply=False, p=0.5)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L1459" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.OpticalDistortion" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>distort_limit</code></td>
<td><code>float, (float, float</code></td>
<td><p>If distort_limit is a single float, the range
will be (-distort_limit, distort_limit). Default: (-0.05, 0.05).</p></td>
</tr>
<tr>
<td><code>shift_limit</code></td>
<td><code>float, (float, float</code></td>
<td><p>If shift_limit is a single float, the range
will be (-shift_limit, shift_limit). Default: (-0.05, 0.05).</p></td>
</tr>
<tr>
<td><code>interpolation</code></td>
<td><code>OpenCV flag</code></td>
<td><p>flag that is used to specify the interpolation algorithm. Should be one of:
cv2.INTER_NEAREST, cv2.INTER_LINEAR, cv2.INTER_CUBIC, cv2.INTER_AREA, cv2.INTER_LANCZOS4.
Default: cv2.INTER_LINEAR.</p></td>
</tr>
<tr>
<td><code>border_mode</code></td>
<td><code>OpenCV flag</code></td>
<td><p>flag that is used to specify the pixel extrapolation method. Should be one of:
cv2.BORDER_CONSTANT, cv2.BORDER_REPLICATE, cv2.BORDER_REFLECT, cv2.BORDER_WRAP, cv2.BORDER_REFLECT_101.
Default: cv2.BORDER_REFLECT_101</p></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>int, float, list of ints, list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT.</p></td>
</tr>
<tr>
<td><code>mask_value</code></td>
<td><code>int, float,
        list of ints,
        list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT applied for masks.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, bboxes</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">OpticalDistortion</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Args:</span>
<span class="sd">        distort_limit (float, (float, float)): If distort_limit is a single float, the range</span>
<span class="sd">            will be (-distort_limit, distort_limit). Default: (-0.05, 0.05).</span>
<span class="sd">        shift_limit (float, (float, float))): If shift_limit is a single float, the range</span>
<span class="sd">            will be (-shift_limit, shift_limit). Default: (-0.05, 0.05).</span>
<span class="sd">        interpolation (OpenCV flag): flag that is used to specify the interpolation algorithm. Should be one of:</span>
<span class="sd">            cv2.INTER_NEAREST, cv2.INTER_LINEAR, cv2.INTER_CUBIC, cv2.INTER_AREA, cv2.INTER_LANCZOS4.</span>
<span class="sd">            Default: cv2.INTER_LINEAR.</span>
<span class="sd">        border_mode (OpenCV flag): flag that is used to specify the pixel extrapolation method. Should be one of:</span>
<span class="sd">            cv2.BORDER_CONSTANT, cv2.BORDER_REPLICATE, cv2.BORDER_REFLECT, cv2.BORDER_WRAP, cv2.BORDER_REFLECT_101.</span>
<span class="sd">            Default: cv2.BORDER_REFLECT_101</span>
<span class="sd">        value (int, float, list of ints, list of float): padding value if border_mode is cv2.BORDER_CONSTANT.</span>
<span class="sd">        mask_value (int, float,</span>
<span class="sd">                    list of ints,</span>
<span class="sd">                    list of float): padding value if border_mode is cv2.BORDER_CONSTANT applied for masks.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, bboxes</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">distort_limit</span><span class="p">:</span> <span class="n">ScaleFloatType</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">shift_limit</span><span class="p">:</span> <span class="n">ScaleFloatType</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="n">border_mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REFLECT_101</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageColorType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageColorType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">shift_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distort_limit</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">distort_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span> <span class="o">=</span> <span class="n">border_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span> <span class="o">=</span> <span class="n">mask_value</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">optical_distortion</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">optical_distortion</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"rows"</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">"cols"</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">bbox_denorm</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">denormalize_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">bbox_denorm</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_min</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_min</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x_max</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y_max</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">y_min</span><span class="p">:</span><span class="n">y_max</span><span class="p">,</span> <span class="n">x_min</span><span class="p">:</span><span class="n">x_max</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">optical_distortion</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span><span class="p">)</span>
        <span class="n">bbox_returned</span> <span class="o">=</span> <span class="n">bbox_from_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">BoxInternalType</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize_bbox</span><span class="p">(</span><span class="n">bbox_returned</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"k"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distort_limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">distort_limit</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s2">"dx"</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
            <span class="s2">"dy"</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">"distort_limit"</span><span class="p">,</span>
            <span class="s2">"shift_limit"</span><span class="p">,</span>
            <span class="s2">"interpolation"</span><span class="p">,</span>
            <span class="s2">"border_mode"</span><span class="p">,</span>
            <span class="s2">"value"</span><span class="p">,</span>
            <span class="s2">"mask_value"</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="PadIfNeeded" id="albumentations.augmentations.geometric.transforms.PadIfNeeded">
<code>class <strong>
PadIfNeeded</strong></code>
<code>


    (min_height=1024, min_width=1024, pad_height_divisor=None, pad_width_divisor=None, position=&lt;PositionType.CENTER: 'center'&gt;, border_mode=4, value=None, mask_value=None, always_apply=False, p=1.0)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L1081" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.PadIfNeeded" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Pad side of the image / max if side is less than desired number.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>min_height</code></td>
<td><code>int</code></td>
<td><p>minimal result image height.</p></td>
</tr>
<tr>
<td><code>min_width</code></td>
<td><code>int</code></td>
<td><p>minimal result image width.</p></td>
</tr>
<tr>
<td><code>pad_height_divisor</code></td>
<td><code>int</code></td>
<td><p>if not None, ensures image height is dividable by value of this argument.</p></td>
</tr>
<tr>
<td><code>pad_width_divisor</code></td>
<td><code>int</code></td>
<td><p>if not None, ensures image width is dividable by value of this argument.</p></td>
</tr>
<tr>
<td><code>position</code></td>
<td><code>Union[str, PositionType]</code></td>
<td><p>Position of the image. should be PositionType.CENTER or
PositionType.TOP_LEFT or PositionType.TOP_RIGHT or PositionType.BOTTOM_LEFT or PositionType.BOTTOM_RIGHT.
or PositionType.RANDOM. Default: PositionType.CENTER.</p></td>
</tr>
<tr>
<td><code>border_mode</code></td>
<td><code>OpenCV flag</code></td>
<td><p>OpenCV border mode.</p></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>int, float, list of int, list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT.</p></td>
</tr>
<tr>
<td><code>mask_value</code></td>
<td><code>int, float,
        list of int,
        list of float</code></td>
<td><p>padding value for mask if border_mode is cv2.BORDER_CONSTANT.</p></td>
</tr>
<tr>
<td><code>p</code></td>
<td><code>float</code></td>
<td><p>probability of applying the transform. Default: 1.0.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, bboxes, keypoints</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PadIfNeeded</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Pad side of the image / max if side is less than desired number.</span>

<span class="sd">    Args:</span>
<span class="sd">        min_height (int): minimal result image height.</span>
<span class="sd">        min_width (int): minimal result image width.</span>
<span class="sd">        pad_height_divisor (int): if not None, ensures image height is dividable by value of this argument.</span>
<span class="sd">        pad_width_divisor (int): if not None, ensures image width is dividable by value of this argument.</span>
<span class="sd">        position (Union[str, PositionType]): Position of the image. should be PositionType.CENTER or</span>
<span class="sd">            PositionType.TOP_LEFT or PositionType.TOP_RIGHT or PositionType.BOTTOM_LEFT or PositionType.BOTTOM_RIGHT.</span>
<span class="sd">            or PositionType.RANDOM. Default: PositionType.CENTER.</span>
<span class="sd">        border_mode (OpenCV flag): OpenCV border mode.</span>
<span class="sd">        value (int, float, list of int, list of float): padding value if border_mode is cv2.BORDER_CONSTANT.</span>
<span class="sd">        mask_value (int, float,</span>
<span class="sd">                    list of int,</span>
<span class="sd">                    list of float): padding value for mask if border_mode is cv2.BORDER_CONSTANT.</span>
<span class="sd">        p (float): probability of applying the transform. Default: 1.0.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, bboxes, keypoints</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="k">class</span> <span class="nc">PositionType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Enumerates the types of positions for placing an object within a container.</span>

<span class="sd">        This Enum class is utilized to define specific anchor positions that an object can</span>
<span class="sd">        assume relative to a container. It's particularly useful in image processing, UI layout,</span>
<span class="sd">        and graphic design to specify the alignment and positioning of elements.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            CENTER (str): Specifies that the object should be placed at the center.</span>
<span class="sd">            TOP_LEFT (str): Specifies that the object should be placed at the top-left corner.</span>
<span class="sd">            TOP_RIGHT (str): Specifies that the object should be placed at the top-right corner.</span>
<span class="sd">            BOTTOM_LEFT (str): Specifies that the object should be placed at the bottom-left corner.</span>
<span class="sd">            BOTTOM_RIGHT (str): Specifies that the object should be placed at the bottom-right corner.</span>
<span class="sd">            RANDOM (str): Indicates that the object's position should be determined randomly.</span>

<span class="sd">        """</span>

        <span class="n">CENTER</span> <span class="o">=</span> <span class="s2">"center"</span>
        <span class="n">TOP_LEFT</span> <span class="o">=</span> <span class="s2">"top_left"</span>
        <span class="n">TOP_RIGHT</span> <span class="o">=</span> <span class="s2">"top_right"</span>
        <span class="n">BOTTOM_LEFT</span> <span class="o">=</span> <span class="s2">"bottom_left"</span>
        <span class="n">BOTTOM_RIGHT</span> <span class="o">=</span> <span class="s2">"bottom_right"</span>
        <span class="n">RANDOM</span> <span class="o">=</span> <span class="s2">"random"</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">min_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="n">min_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="n">pad_height_divisor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pad_width_divisor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">position</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">PositionType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">PositionType</span><span class="o">.</span><span class="n">CENTER</span><span class="p">,</span>
        <span class="n">border_mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REFLECT_101</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageColorType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageColorType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">min_height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">pad_height_divisor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Only one of 'min_height' and 'pad_height_divisor' parameters must be set"</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">min_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">pad_width_divisor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Only one of 'min_width' and 'pad_width_divisor' parameters must be set"</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span> <span class="o">=</span> <span class="n">min_height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_width</span> <span class="o">=</span> <span class="n">min_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_width_divisor</span> <span class="o">=</span> <span class="n">pad_width_divisor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_height_divisor</span> <span class="o">=</span> <span class="n">pad_height_divisor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">PadIfNeeded</span><span class="o">.</span><span class="n">PositionType</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span> <span class="o">=</span> <span class="n">border_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span> <span class="o">=</span> <span class="n">mask_value</span>

    <span class="k">def</span> <span class="nf">update_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">update_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"rows"</span><span class="p">]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"cols"</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rows</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span><span class="p">:</span>
                <span class="n">h_pad_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">min_height</span> <span class="o">-</span> <span class="n">rows</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="n">h_pad_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span> <span class="o">-</span> <span class="n">rows</span> <span class="o">-</span> <span class="n">h_pad_top</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">h_pad_top</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">h_pad_bottom</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pad_remained</span> <span class="o">=</span> <span class="n">rows</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_height_divisor</span>
            <span class="n">pad_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_height_divisor</span> <span class="o">-</span> <span class="n">pad_remained</span> <span class="k">if</span> <span class="n">pad_remained</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">h_pad_top</span> <span class="o">=</span> <span class="n">pad_rows</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">h_pad_bottom</span> <span class="o">=</span> <span class="n">pad_rows</span> <span class="o">-</span> <span class="n">h_pad_top</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cols</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_width</span><span class="p">:</span>
                <span class="n">w_pad_left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">min_width</span> <span class="o">-</span> <span class="n">cols</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="n">w_pad_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_width</span> <span class="o">-</span> <span class="n">cols</span> <span class="o">-</span> <span class="n">w_pad_left</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w_pad_left</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">w_pad_right</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pad_remainder</span> <span class="o">=</span> <span class="n">cols</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_width_divisor</span>
            <span class="n">pad_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_width_divisor</span> <span class="o">-</span> <span class="n">pad_remainder</span> <span class="k">if</span> <span class="n">pad_remainder</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">w_pad_left</span> <span class="o">=</span> <span class="n">pad_cols</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">w_pad_right</span> <span class="o">=</span> <span class="n">pad_cols</span> <span class="o">-</span> <span class="n">w_pad_left</span>

        <span class="n">h_pad_top</span><span class="p">,</span> <span class="n">h_pad_bottom</span><span class="p">,</span> <span class="n">w_pad_left</span><span class="p">,</span> <span class="n">w_pad_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__update_position_params</span><span class="p">(</span>
            <span class="n">h_top</span><span class="o">=</span><span class="n">h_pad_top</span><span class="p">,</span> <span class="n">h_bottom</span><span class="o">=</span><span class="n">h_pad_bottom</span><span class="p">,</span> <span class="n">w_left</span><span class="o">=</span><span class="n">w_pad_left</span><span class="p">,</span> <span class="n">w_right</span><span class="o">=</span><span class="n">w_pad_right</span>
        <span class="p">)</span>

        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">"pad_top"</span><span class="p">:</span> <span class="n">h_pad_top</span><span class="p">,</span>
                <span class="s2">"pad_bottom"</span><span class="p">:</span> <span class="n">h_pad_bottom</span><span class="p">,</span>
                <span class="s2">"pad_left"</span><span class="p">:</span> <span class="n">w_pad_left</span><span class="p">,</span>
                <span class="s2">"pad_right"</span><span class="p">:</span> <span class="n">w_pad_right</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">pad_top</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_bottom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_right</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">pad_with_params</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="n">pad_top</span><span class="p">,</span>
            <span class="n">pad_bottom</span><span class="p">,</span>
            <span class="n">pad_left</span><span class="p">,</span>
            <span class="n">pad_right</span><span class="p">,</span>
            <span class="n">border_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">pad_top</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_bottom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_right</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">pad_with_params</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="n">pad_top</span><span class="p">,</span>
            <span class="n">pad_bottom</span><span class="p">,</span>
            <span class="n">pad_left</span><span class="p">,</span>
            <span class="n">pad_right</span><span class="p">,</span>
            <span class="n">border_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span>
        <span class="n">pad_top</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_bottom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_right</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">denormalize_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">x_min</span> <span class="o">+</span> <span class="n">pad_left</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">+</span> <span class="n">pad_top</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">+</span> <span class="n">pad_left</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">+</span> <span class="n">pad_top</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">BoxInternalType</span><span class="p">,</span> <span class="n">normalize_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">rows</span> <span class="o">+</span> <span class="n">pad_top</span> <span class="o">+</span> <span class="n">pad_bottom</span><span class="p">,</span> <span class="n">cols</span> <span class="o">+</span> <span class="n">pad_left</span> <span class="o">+</span> <span class="n">pad_right</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span>
        <span class="n">pad_top</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_bottom</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">pad_right</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeypointInternalType</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">keypoint</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">pad_left</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">pad_top</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">"min_height"</span><span class="p">,</span>
            <span class="s2">"min_width"</span><span class="p">,</span>
            <span class="s2">"pad_height_divisor"</span><span class="p">,</span>
            <span class="s2">"pad_width_divisor"</span><span class="p">,</span>
            <span class="s2">"border_mode"</span><span class="p">,</span>
            <span class="s2">"value"</span><span class="p">,</span>
            <span class="s2">"mask_value"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__update_position_params</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">h_top</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">h_bottom</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">w_left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">w_right</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">PadIfNeeded</span><span class="o">.</span><span class="n">PositionType</span><span class="o">.</span><span class="n">TOP_LEFT</span><span class="p">:</span>
            <span class="n">h_bottom</span> <span class="o">+=</span> <span class="n">h_top</span>
            <span class="n">w_right</span> <span class="o">+=</span> <span class="n">w_left</span>
            <span class="n">h_top</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">w_left</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">PadIfNeeded</span><span class="o">.</span><span class="n">PositionType</span><span class="o">.</span><span class="n">TOP_RIGHT</span><span class="p">:</span>
            <span class="n">h_bottom</span> <span class="o">+=</span> <span class="n">h_top</span>
            <span class="n">w_left</span> <span class="o">+=</span> <span class="n">w_right</span>
            <span class="n">h_top</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">w_right</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">PadIfNeeded</span><span class="o">.</span><span class="n">PositionType</span><span class="o">.</span><span class="n">BOTTOM_LEFT</span><span class="p">:</span>
            <span class="n">h_top</span> <span class="o">+=</span> <span class="n">h_bottom</span>
            <span class="n">w_right</span> <span class="o">+=</span> <span class="n">w_left</span>
            <span class="n">h_bottom</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">w_left</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">PadIfNeeded</span><span class="o">.</span><span class="n">PositionType</span><span class="o">.</span><span class="n">BOTTOM_RIGHT</span><span class="p">:</span>
            <span class="n">h_top</span> <span class="o">+=</span> <span class="n">h_bottom</span>
            <span class="n">w_left</span> <span class="o">+=</span> <span class="n">w_right</span>
            <span class="n">h_bottom</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">w_right</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="n">PadIfNeeded</span><span class="o">.</span><span class="n">PositionType</span><span class="o">.</span><span class="n">RANDOM</span><span class="p">:</span>
            <span class="n">h_pad</span> <span class="o">=</span> <span class="n">h_top</span> <span class="o">+</span> <span class="n">h_bottom</span>
            <span class="n">w_pad</span> <span class="o">=</span> <span class="n">w_left</span> <span class="o">+</span> <span class="n">w_right</span>
            <span class="n">h_top</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_pad</span><span class="p">)</span>
            <span class="n">h_bottom</span> <span class="o">=</span> <span class="n">h_pad</span> <span class="o">-</span> <span class="n">h_top</span>
            <span class="n">w_left</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w_pad</span><span class="p">)</span>
            <span class="n">w_right</span> <span class="o">=</span> <span class="n">w_pad</span> <span class="o">-</span> <span class="n">w_left</span>

        <span class="k">return</span> <span class="n">h_top</span><span class="p">,</span> <span class="n">h_bottom</span><span class="p">,</span> <span class="n">w_left</span><span class="p">,</span> <span class="n">w_right</span>
</code></pre></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h3 class="doc doc-heading" data-toc-label="PositionType" id="albumentations.augmentations.geometric.transforms.PadIfNeeded.PositionType">
<code>class <strong>
PositionType</strong></code>
<code>
</code> <a class="headerlink" href="#albumentations.augmentations.geometric.transforms.PadIfNeeded.PositionType" title="Permanent link">¶</a>
</h3>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Enumerates the types of positions for placing an object within a container.</p>
<p>This Enum class is utilized to define specific anchor positions that an object can
assume relative to a container. It's particularly useful in image processing, UI layout,
and graphic design to specify the alignment and positioning of elements.</p>
<p><strong>Attributes:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CENTER</code></td>
<td><code>str</code></td>
<td><p>Specifies that the object should be placed at the center.</p></td>
</tr>
<tr>
<td><code>TOP_LEFT</code></td>
<td><code>str</code></td>
<td><p>Specifies that the object should be placed at the top-left corner.</p></td>
</tr>
<tr>
<td><code>TOP_RIGHT</code></td>
<td><code>str</code></td>
<td><p>Specifies that the object should be placed at the top-right corner.</p></td>
</tr>
<tr>
<td><code>BOTTOM_LEFT</code></td>
<td><code>str</code></td>
<td><p>Specifies that the object should be placed at the bottom-left corner.</p></td>
</tr>
<tr>
<td><code>BOTTOM_RIGHT</code></td>
<td><code>str</code></td>
<td><p>Specifies that the object should be placed at the bottom-right corner.</p></td>
</tr>
<tr>
<td><code>RANDOM</code></td>
<td><code>str</code></td>
<td><p>Indicates that the object's position should be determined randomly.</p></td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PositionType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Enumerates the types of positions for placing an object within a container.</span>

<span class="sd">    This Enum class is utilized to define specific anchor positions that an object can</span>
<span class="sd">    assume relative to a container. It's particularly useful in image processing, UI layout,</span>
<span class="sd">    and graphic design to specify the alignment and positioning of elements.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        CENTER (str): Specifies that the object should be placed at the center.</span>
<span class="sd">        TOP_LEFT (str): Specifies that the object should be placed at the top-left corner.</span>
<span class="sd">        TOP_RIGHT (str): Specifies that the object should be placed at the top-right corner.</span>
<span class="sd">        BOTTOM_LEFT (str): Specifies that the object should be placed at the bottom-left corner.</span>
<span class="sd">        BOTTOM_RIGHT (str): Specifies that the object should be placed at the bottom-right corner.</span>
<span class="sd">        RANDOM (str): Indicates that the object's position should be determined randomly.</span>

<span class="sd">    """</span>

    <span class="n">CENTER</span> <span class="o">=</span> <span class="s2">"center"</span>
    <span class="n">TOP_LEFT</span> <span class="o">=</span> <span class="s2">"top_left"</span>
    <span class="n">TOP_RIGHT</span> <span class="o">=</span> <span class="s2">"top_right"</span>
    <span class="n">BOTTOM_LEFT</span> <span class="o">=</span> <span class="s2">"bottom_left"</span>
    <span class="n">BOTTOM_RIGHT</span> <span class="o">=</span> <span class="s2">"bottom_right"</span>
    <span class="n">RANDOM</span> <span class="o">=</span> <span class="s2">"random"</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="Perspective" id="albumentations.augmentations.geometric.transforms.Perspective">
<code>class <strong>
Perspective</strong></code>
<code>


    (scale=(0.05, 0.1), keep_size=True, pad_mode=0, pad_val=0, mask_pad_val=0, fit_output=False, interpolation=1, always_apply=False, p=0.5)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L341" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.Perspective" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Perform a random four point perspective transform of the input.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scale</code></td>
<td><code>Union[float, Tuple[float, float]]</code></td>
<td><p>standard deviation of the normal distributions. These are used to sample
the random distances of the subimage's corners from the full image's corners.
If scale is a single float value, the range will be (0, scale). Default: (0.05, 0.1).</p></td>
</tr>
<tr>
<td><code>keep_size</code></td>
<td><code>bool</code></td>
<td><p>Whether to resize image back to their original size after applying the perspective
transform. If set to False, the resulting images may end up having different shapes
and will always be a list, never an array. Default: True</p></td>
</tr>
<tr>
<td><code>pad_mode</code></td>
<td><code>OpenCV flag</code></td>
<td><p>OpenCV border mode.</p></td>
</tr>
<tr>
<td><code>pad_val</code></td>
<td><code>int, float, list of int, list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT.
Default: 0</p></td>
</tr>
<tr>
<td><code>mask_pad_val</code></td>
<td><code>int, float, list of int, list of float</code></td>
<td><p>padding value for mask
if border_mode is cv2.BORDER_CONSTANT. Default: 0</p></td>
</tr>
<tr>
<td><code>fit_output</code></td>
<td><code>bool</code></td>
<td><p>If True, the image plane size and position will be adjusted to still capture
the whole image after perspective transformation. (Followed by image resizing if keep_size is set to True.)
Otherwise, parts of the transformed image may be outside of the image plane.
This setting should not be set to True when using large scale values as it could lead to very large images.
Default: False</p></td>
</tr>
<tr>
<td><code>p</code></td>
<td><code>float</code></td>
<td><p>probability of applying the transform. Default: 0.5.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, keypoints, bboxes</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Perspective</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Perform a random four point perspective transform of the input.</span>

<span class="sd">    Args:</span>
<span class="sd">        scale: standard deviation of the normal distributions. These are used to sample</span>
<span class="sd">            the random distances of the subimage's corners from the full image's corners.</span>
<span class="sd">            If scale is a single float value, the range will be (0, scale). Default: (0.05, 0.1).</span>
<span class="sd">        keep_size: Whether to resize image back to their original size after applying the perspective</span>
<span class="sd">            transform. If set to False, the resulting images may end up having different shapes</span>
<span class="sd">            and will always be a list, never an array. Default: True</span>
<span class="sd">        pad_mode (OpenCV flag): OpenCV border mode.</span>
<span class="sd">        pad_val (int, float, list of int, list of float): padding value if border_mode is cv2.BORDER_CONSTANT.</span>
<span class="sd">            Default: 0</span>
<span class="sd">        mask_pad_val (int, float, list of int, list of float): padding value for mask</span>
<span class="sd">            if border_mode is cv2.BORDER_CONSTANT. Default: 0</span>
<span class="sd">        fit_output (bool): If True, the image plane size and position will be adjusted to still capture</span>
<span class="sd">            the whole image after perspective transformation. (Followed by image resizing if keep_size is set to True.)</span>
<span class="sd">            Otherwise, parts of the transformed image may be outside of the image plane.</span>
<span class="sd">            This setting should not be set to True when using large scale values as it could lead to very large images.</span>
<span class="sd">            Default: False</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, keypoints, bboxes</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">ScaleFloatType</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
        <span class="n">keep_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">pad_mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_CONSTANT</span><span class="p">,</span>
        <span class="n">pad_val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">mask_pad_val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">fit_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_size</span> <span class="o">=</span> <span class="n">keep_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span> <span class="o">=</span> <span class="n">pad_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad_val</span> <span class="o">=</span> <span class="n">pad_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_pad_val</span> <span class="o">=</span> <span class="n">mask_pad_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_output</span> <span class="o">=</span> <span class="n">fit_output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">perspective</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_size</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">"interpolation"</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">perspective_bbox</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">"rows"</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">"cols"</span><span class="p">],</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">perspective_keypoint</span><span class="p">(</span>
            <span class="n">keypoint</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s2">"rows"</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">"cols"</span><span class="p">],</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_size</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targets_as_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">"image"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_params_dependent_on_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"image"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="n">random_utils</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">random_utils</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="mf">0.32</span><span class="p">)</span>

        <span class="c1"># top left -- no changes needed, just use jitter</span>
        <span class="c1"># top right</span>
        <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># w = 1.0 - jitter</span>
        <span class="c1"># bottom right</span>
        <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># w = 1.0 - jitt</span>
        <span class="c1"># bottom left</span>
        <span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># h = 1.0 - jitter</span>

        <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">width</span>
        <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">height</span>

        <span class="c1"># Obtain a consistent order of the points and unpack them individually.</span>
        <span class="c1"># Warning: don't just do (tl, tr, br, bl) = _order_points(...)</span>
        <span class="c1"># here, because the reordered points is used further below.</span>
        <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">bl</span> <span class="o">=</span> <span class="n">points</span>

        <span class="c1"># compute the width of the new image, which will be the</span>
        <span class="c1"># maximum distance between bottom-right and bottom-left</span>
        <span class="c1"># x-coordiates or the top-right and top-left x-coordinates</span>
        <span class="n">min_width</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_width</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">min_width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">min_width</span> <span class="o">&lt;</span> <span class="n">TWO</span><span class="p">:</span>
            <span class="n">width_top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">tl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">width_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">br</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">br</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">max_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">width_top</span><span class="p">,</span> <span class="n">width_bottom</span><span class="p">))</span>
            <span class="n">min_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">width_top</span><span class="p">,</span> <span class="n">width_bottom</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">min_width</span> <span class="o">&lt;</span> <span class="n">TWO</span><span class="p">:</span>
                <span class="n">step_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">min_width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">tl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step_size</span>
                <span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step_size</span>
                <span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step_size</span>
                <span class="n">br</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step_size</span>

        <span class="c1"># compute the height of the new image, which will be the maximum distance between the top-right</span>
        <span class="c1"># and bottom-right y-coordinates or the top-left and bottom-left y-coordinates</span>
        <span class="n">min_height</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_height</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="n">min_height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">min_height</span> <span class="o">&lt;</span> <span class="n">TWO</span><span class="p">:</span>
            <span class="n">height_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">br</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">height_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">tl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">max_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">height_right</span><span class="p">,</span> <span class="n">height_left</span><span class="p">))</span>
            <span class="n">min_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">height_right</span><span class="p">,</span> <span class="n">height_left</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">min_height</span> <span class="o">&lt;</span> <span class="n">TWO</span><span class="p">:</span>
                <span class="n">step_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="n">min_height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">tl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step_size</span>
                <span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">step_size</span>
                <span class="n">bl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step_size</span>
                <span class="n">br</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">step_size</span>

        <span class="c1"># now that we have the dimensions of the new image, construct</span>
        <span class="c1"># the set of destination points to obtain a "birds eye view",</span>
        <span class="c1"># (i.e. top-down view) of the image, again specifying points</span>
        <span class="c1"># in the top-left, top-right, bottom-right, and bottom-left order</span>
        <span class="c1"># do not use width-1 or height-1 here, as for e.g. width=3, height=2</span>
        <span class="c1"># the bottom right coordinate is at (3.0, 2.0) and not (2.0, 1.0)</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">max_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_height</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># compute the perspective transform matrix and then apply it</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_output</span><span class="p">:</span>
            <span class="n">m</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_transform</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">"matrix"</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span> <span class="s2">"max_height"</span><span class="p">:</span> <span class="n">max_height</span><span class="p">,</span> <span class="s2">"max_width"</span><span class="p">:</span> <span class="n">max_width</span><span class="p">,</span> <span class="s2">"interpolation"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_expand_transform</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">SizeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># do not use width-1 or height-1 here, as for e.g. width=3, height=2, max_height</span>
        <span class="c1"># the bottom right coordinate is at (3.0, 2.0) and not (2.0, 1.0)</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rect</span><span class="p">]),</span> <span class="n">matrix</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># get min x, y over transformed 4 points</span>
        <span class="c1"># then modify target points by subtracting these minima  =&gt; shift to (0, 0)</span>
        <span class="n">dst</span> <span class="o">-=</span> <span class="n">dst</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">matrix_expanded</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getPerspectiveTransform</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
        <span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matrix_expanded</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_width</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_height</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_order_points</span><span class="p">(</span><span class="n">pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># points with smallest x coordinate - left points</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>  <span class="c1"># points with greatest x coordinate - right points</span>

        <span class="k">if</span> <span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">left</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">tl</span><span class="p">,</span> <span class="n">bl</span> <span class="o">=</span> <span class="n">left</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bl</span><span class="p">,</span> <span class="n">tl</span> <span class="o">=</span> <span class="n">left</span>

        <span class="k">if</span> <span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">tr</span><span class="p">,</span> <span class="n">br</span> <span class="o">=</span> <span class="n">right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">br</span><span class="p">,</span> <span class="n">tr</span> <span class="o">=</span> <span class="n">right</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tl</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">br</span><span class="p">,</span> <span class="n">bl</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="s2">"scale"</span><span class="p">,</span> <span class="s2">"keep_size"</span><span class="p">,</span> <span class="s2">"pad_mode"</span><span class="p">,</span> <span class="s2">"pad_val"</span><span class="p">,</span> <span class="s2">"mask_pad_val"</span><span class="p">,</span> <span class="s2">"fit_output"</span><span class="p">,</span> <span class="s2">"interpolation"</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="PiecewiseAffine" id="albumentations.augmentations.geometric.transforms.PiecewiseAffine">
<code>class <strong>
PiecewiseAffine</strong></code>
<code>


    (scale=(0.03, 0.05), nb_rows=4, nb_cols=4, interpolation=1, mask_interpolation=0, cval=0, cval_mask=0, mode='constant', absolute_scale=False, always_apply=False, keypoints_threshold=0.01, p=0.5)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L927" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.PiecewiseAffine" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Apply affine transformations that differ between local neighbourhoods.
This augmentation places a regular grid of points on an image and randomly moves the neighbourhood of these point
around via affine transformations. This leads to local distortions.</p>
<p>This is mostly a wrapper around scikit-image's <code>PiecewiseAffine</code>.
See also <code>Affine</code> for a similar technique.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This augmenter is very slow. Try to use <code>ElasticTransformation</code> instead, which is at least 10x faster.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For coordinate-based inputs (keypoints, bounding boxes, polygons, ...),
this augmenter still has to perform an image-based augmentation,
which will make it significantly slower and not fully correct for such inputs than other transforms.</p>
</div>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scale</code></td>
<td><code>float, tuple of float</code></td>
<td><p>Each point on the regular grid is moved around via a normal distribution.
This scale factor is equivalent to the normal distribution's sigma.
Note that the jitter (how far each point is moved in which direction) is multiplied by the height/width of
the image if <code>absolute_scale=False</code> (default), so this scale can be the same for different sized images.
Recommended values are in the range <code>0.01</code> to <code>0.05</code> (weak to strong augmentations).
    * If a single <code>float</code>, then that value will always be used as the scale.
    * If a tuple <code>(a, b)</code> of <code>float</code> s, then a random value will
      be uniformly sampled per image from the interval <code>[a, b]</code>.</p></td>
</tr>
<tr>
<td><code>nb_rows</code></td>
<td><code>int, tuple of int</code></td>
<td><p>Number of rows of points that the regular grid should have.
Must be at least <code>2</code>. For large images, you might want to pick a higher value than <code>4</code>.
You might have to then adjust scale to lower values.
    * If a single <code>int</code>, then that value will always be used as the number of rows.
    * If a tuple <code>(a, b)</code>, then a value from the discrete interval
      <code>[a..b]</code> will be uniformly sampled per image.</p></td>
</tr>
<tr>
<td><code>nb_cols</code></td>
<td><code>int, tuple of int</code></td>
<td><p>Number of columns. Analogous to <code>nb_rows</code>.</p></td>
</tr>
<tr>
<td><code>interpolation</code></td>
<td><code>int</code></td>
<td><p>The order of interpolation. The order has to be in the range 0-5:
 - 0: Nearest-neighbor
 - 1: Bi-linear (default)
 - 2: Bi-quadratic
 - 3: Bi-cubic
 - 4: Bi-quartic
 - 5: Bi-quintic</p></td>
</tr>
<tr>
<td><code>mask_interpolation</code></td>
<td><code>int</code></td>
<td><p>same as interpolation but for mask.</p></td>
</tr>
<tr>
<td><code>cval</code></td>
<td><code>number</code></td>
<td><p>The constant value to use when filling in newly created pixels.</p></td>
</tr>
<tr>
<td><code>cval_mask</code></td>
<td><code>number</code></td>
<td><p>Same as cval but only for masks.</p></td>
</tr>
<tr>
<td><code>mode</code></td>
<td><code>str</code></td>
<td><p>{'constant', 'edge', 'symmetric', 'reflect', 'wrap'}, optional
Points outside the boundaries of the input are filled according
to the given mode.  Modes match the behaviour of <code>numpy.pad</code>.</p></td>
</tr>
<tr>
<td><code>absolute_scale</code></td>
<td><code>bool</code></td>
<td><p>Take <code>scale</code> as an absolute value rather than a relative value.</p></td>
</tr>
<tr>
<td><code>keypoints_threshold</code></td>
<td><code>float</code></td>
<td><p>Used as threshold in conversion from distance maps to keypoints.
The search for keypoints works by searching for the
argmin (non-inverted) or argmax (inverted) in each channel. This
parameters contains the maximum (non-inverted) or minimum (inverted) value to accept in order to view a hit
as a keypoint. Use <code>None</code> to use no min/max. Default: 0.01</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, keypoints, bboxes</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">PiecewiseAffine</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Apply affine transformations that differ between local neighbourhoods.</span>
<span class="sd">    This augmentation places a regular grid of points on an image and randomly moves the neighbourhood of these point</span>
<span class="sd">    around via affine transformations. This leads to local distortions.</span>

<span class="sd">    This is mostly a wrapper around scikit-image's ``PiecewiseAffine``.</span>
<span class="sd">    See also ``Affine`` for a similar technique.</span>

<span class="sd">    Note:</span>
<span class="sd">        This augmenter is very slow. Try to use ``ElasticTransformation`` instead, which is at least 10x faster.</span>

<span class="sd">    Note:</span>
<span class="sd">        For coordinate-based inputs (keypoints, bounding boxes, polygons, ...),</span>
<span class="sd">        this augmenter still has to perform an image-based augmentation,</span>
<span class="sd">        which will make it significantly slower and not fully correct for such inputs than other transforms.</span>

<span class="sd">    Args:</span>
<span class="sd">        scale (float, tuple of float): Each point on the regular grid is moved around via a normal distribution.</span>
<span class="sd">            This scale factor is equivalent to the normal distribution's sigma.</span>
<span class="sd">            Note that the jitter (how far each point is moved in which direction) is multiplied by the height/width of</span>
<span class="sd">            the image if ``absolute_scale=False`` (default), so this scale can be the same for different sized images.</span>
<span class="sd">            Recommended values are in the range ``0.01`` to ``0.05`` (weak to strong augmentations).</span>
<span class="sd">                * If a single ``float``, then that value will always be used as the scale.</span>
<span class="sd">                * If a tuple ``(a, b)`` of ``float`` s, then a random value will</span>
<span class="sd">                  be uniformly sampled per image from the interval ``[a, b]``.</span>
<span class="sd">        nb_rows (int, tuple of int): Number of rows of points that the regular grid should have.</span>
<span class="sd">            Must be at least ``2``. For large images, you might want to pick a higher value than ``4``.</span>
<span class="sd">            You might have to then adjust scale to lower values.</span>
<span class="sd">                * If a single ``int``, then that value will always be used as the number of rows.</span>
<span class="sd">                * If a tuple ``(a, b)``, then a value from the discrete interval</span>
<span class="sd">                  ``[a..b]`` will be uniformly sampled per image.</span>
<span class="sd">        nb_cols (int, tuple of int): Number of columns. Analogous to `nb_rows`.</span>
<span class="sd">        interpolation (int): The order of interpolation. The order has to be in the range 0-5:</span>
<span class="sd">             - 0: Nearest-neighbor</span>
<span class="sd">             - 1: Bi-linear (default)</span>
<span class="sd">             - 2: Bi-quadratic</span>
<span class="sd">             - 3: Bi-cubic</span>
<span class="sd">             - 4: Bi-quartic</span>
<span class="sd">             - 5: Bi-quintic</span>
<span class="sd">        mask_interpolation (int): same as interpolation but for mask.</span>
<span class="sd">        cval (number): The constant value to use when filling in newly created pixels.</span>
<span class="sd">        cval_mask (number): Same as cval but only for masks.</span>
<span class="sd">        mode (str): {'constant', 'edge', 'symmetric', 'reflect', 'wrap'}, optional</span>
<span class="sd">            Points outside the boundaries of the input are filled according</span>
<span class="sd">            to the given mode.  Modes match the behaviour of `numpy.pad`.</span>
<span class="sd">        absolute_scale (bool): Take `scale` as an absolute value rather than a relative value.</span>
<span class="sd">        keypoints_threshold (float): Used as threshold in conversion from distance maps to keypoints.</span>
<span class="sd">            The search for keypoints works by searching for the</span>
<span class="sd">            argmin (non-inverted) or argmax (inverted) in each channel. This</span>
<span class="sd">            parameters contains the maximum (non-inverted) or minimum (inverted) value to accept in order to view a hit</span>
<span class="sd">            as a keypoint. Use ``None`` to use no min/max. Default: 0.01</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, keypoints, bboxes</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="n">ScaleFloatType</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span>
        <span class="n">nb_rows</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ScaleIntType</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">nb_cols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ScaleIntType</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">mask_interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cval_mask</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"constant"</span><span class="p">,</span>
        <span class="n">absolute_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">keypoints_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_rows</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">nb_rows</span><span class="p">,</span> <span class="n">nb_rows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_cols</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">nb_cols</span><span class="p">,</span> <span class="n">nb_cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_interpolation</span> <span class="o">=</span> <span class="n">mask_interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cval</span> <span class="o">=</span> <span class="n">cval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cval_mask</span> <span class="o">=</span> <span class="n">cval_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolute_scale</span> <span class="o">=</span> <span class="n">absolute_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keypoints_threshold</span> <span class="o">=</span> <span class="n">keypoints_threshold</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s2">"scale"</span><span class="p">,</span>
            <span class="s2">"nb_rows"</span><span class="p">,</span>
            <span class="s2">"nb_cols"</span><span class="p">,</span>
            <span class="s2">"interpolation"</span><span class="p">,</span>
            <span class="s2">"mask_interpolation"</span><span class="p">,</span>
            <span class="s2">"cval"</span><span class="p">,</span>
            <span class="s2">"cval_mask"</span><span class="p">,</span>
            <span class="s2">"mode"</span><span class="p">,</span>
            <span class="s2">"absolute_scale"</span><span class="p">,</span>
            <span class="s2">"keypoints_threshold"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">targets_as_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">"image"</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_params_dependent_on_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">"image"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">nb_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_rows</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">nb_cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nb_cols</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">nb_cells</span> <span class="o">=</span> <span class="n">nb_cols</span> <span class="o">*</span> <span class="n">nb_rows</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span>

        <span class="n">jitter</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">random_utils</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="p">(</span><span class="n">nb_cells</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jitter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>  <span class="c1"># See: https://github.com/albumentations-team/albumentations/issues/1442</span>
                <span class="n">jitter</span> <span class="o">=</span> <span class="n">random_utils</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="p">(</span><span class="n">nb_cells</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jitter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jitter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">{</span><span class="s2">"matrix"</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">nb_rows</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">nb_cols</span><span class="p">)</span>

        <span class="c1"># (H, W) and (H, W) for H=rows, W=cols</span>
        <span class="n">xx_src</span><span class="p">,</span> <span class="n">yy_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># (1, HW, 2) =&gt; (HW, 2) for H=rows, W=cols</span>
        <span class="n">points_src</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">yy_src</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">xx_src</span><span class="o">.</span><span class="n">flat</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolute_scale</span><span class="p">:</span>
            <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span> <span class="k">if</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
            <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">width</span> <span class="k">if</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

        <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">height</span>
        <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">width</span>

        <span class="n">points_dest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">points_src</span><span class="p">)</span>
        <span class="n">points_dest</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">points_dest</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">points_dest</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">points_dest</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">jitter</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Restrict all destination points to be inside the image plane.</span>
        <span class="c1"># This is necessary, as otherwise keypoints could be augmented</span>
        <span class="c1"># outside of the image plane and these would be replaced by</span>
        <span class="c1"># (-1, -1), which would not conform with the behaviour of the other augmenters.</span>
        <span class="n">points_dest</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">points_dest</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">points_dest</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">points_dest</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">matrix</span> <span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">PiecewiseAffineTransform</span><span class="p">()</span>
        <span class="n">matrix</span><span class="o">.</span><span class="n">estimate</span><span class="p">(</span><span class="n">points_src</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points_dest</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"matrix"</span><span class="p">:</span> <span class="n">matrix</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">PiecewiseAffineTransform</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">piecewise_affine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">PiecewiseAffineTransform</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">piecewise_affine</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_interpolation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cval_mask</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">PiecewiseAffineTransform</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">bbox_piecewise_affine</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keypoints_threshold</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">skimage</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">PiecewiseAffineTransform</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeypointInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">keypoint_piecewise_affine</span><span class="p">(</span><span class="n">keypoint</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keypoints_threshold</span><span class="p">)</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="ShiftScaleRotate" id="albumentations.augmentations.geometric.transforms.ShiftScaleRotate">
<code>class <strong>
ShiftScaleRotate</strong></code>
<code>


    (shift_limit=0.0625, scale_limit=0.1, rotate_limit=45, interpolation=1, border_mode=4, value=None, mask_value=None, shift_limit_x=None, shift_limit_y=None, rotate_method='largest_box', always_apply=False, p=0.5)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L90" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.ShiftScaleRotate" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Randomly apply affine transforms: translate, scale and rotate the input.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>shift_limit</code></td>
<td><code>float, float) or float</code></td>
<td><p>shift factor range for both height and width. If shift_limit
is a single float value, the range will be (-shift_limit, shift_limit). Absolute values for lower and
upper bounds should lie in range [0, 1]. Default: (-0.0625, 0.0625).</p></td>
</tr>
<tr>
<td><code>scale_limit</code></td>
<td><code>float, float) or float</code></td>
<td><p>scaling factor range. If scale_limit is a single float value, the
range will be (-scale_limit, scale_limit). Note that the scale_limit will be biased by 1.
If scale_limit is a tuple, like (low, high), sampling will be done from the range (1 + low, 1 + high).
Default: (-0.1, 0.1).</p></td>
</tr>
<tr>
<td><code>rotate_limit</code></td>
<td><code>int, int) or int</code></td>
<td><p>rotation range. If rotate_limit is a single int value, the
range will be (-rotate_limit, rotate_limit). Default: (-45, 45).</p></td>
</tr>
<tr>
<td><code>interpolation</code></td>
<td><code>OpenCV flag</code></td>
<td><p>flag that is used to specify the interpolation algorithm. Should be one of:
cv2.INTER_NEAREST, cv2.INTER_LINEAR, cv2.INTER_CUBIC, cv2.INTER_AREA, cv2.INTER_LANCZOS4.
Default: cv2.INTER_LINEAR.</p></td>
</tr>
<tr>
<td><code>border_mode</code></td>
<td><code>OpenCV flag</code></td>
<td><p>flag that is used to specify the pixel extrapolation method. Should be one of:
cv2.BORDER_CONSTANT, cv2.BORDER_REPLICATE, cv2.BORDER_REFLECT, cv2.BORDER_WRAP, cv2.BORDER_REFLECT_101.
Default: cv2.BORDER_REFLECT_101</p></td>
</tr>
<tr>
<td><code>value</code></td>
<td><code>int, float, list of int, list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT.</p></td>
</tr>
<tr>
<td><code>mask_value</code></td>
<td><code>int, float,
        list of int,
        list of float</code></td>
<td><p>padding value if border_mode is cv2.BORDER_CONSTANT applied for masks.</p></td>
</tr>
<tr>
<td><code>shift_limit_x</code></td>
<td><code>float, float) or float</code></td>
<td><p>shift factor range for width. If it is set then this value
instead of shift_limit will be used for shifting width.  If shift_limit_x is a single float value,
the range will be (-shift_limit_x, shift_limit_x). Absolute values for lower and upper bounds should lie in
the range [0, 1]. Default: None.</p></td>
</tr>
<tr>
<td><code>shift_limit_y</code></td>
<td><code>float, float) or float</code></td>
<td><p>shift factor range for height. If it is set then this value
instead of shift_limit will be used for shifting height.  If shift_limit_y is a single float value,
the range will be (-shift_limit_y, shift_limit_y). Absolute values for lower and upper bounds should lie
in the range [0, 1]. Default: None.</p></td>
</tr>
<tr>
<td><code>rotate_method</code></td>
<td><code>str</code></td>
<td><p>rotation method used for the bounding boxes. Should be one of "largest_box" or "ellipse".
Default: "largest_box"</p></td>
</tr>
<tr>
<td><code>p</code></td>
<td><code>float</code></td>
<td><p>probability of applying the transform. Default: 0.5.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, keypoints, bboxes</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ShiftScaleRotate</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Randomly apply affine transforms: translate, scale and rotate the input.</span>

<span class="sd">    Args:</span>
<span class="sd">        shift_limit ((float, float) or float): shift factor range for both height and width. If shift_limit</span>
<span class="sd">            is a single float value, the range will be (-shift_limit, shift_limit). Absolute values for lower and</span>
<span class="sd">            upper bounds should lie in range [0, 1]. Default: (-0.0625, 0.0625).</span>
<span class="sd">        scale_limit ((float, float) or float): scaling factor range. If scale_limit is a single float value, the</span>
<span class="sd">            range will be (-scale_limit, scale_limit). Note that the scale_limit will be biased by 1.</span>
<span class="sd">            If scale_limit is a tuple, like (low, high), sampling will be done from the range (1 + low, 1 + high).</span>
<span class="sd">            Default: (-0.1, 0.1).</span>
<span class="sd">        rotate_limit ((int, int) or int): rotation range. If rotate_limit is a single int value, the</span>
<span class="sd">            range will be (-rotate_limit, rotate_limit). Default: (-45, 45).</span>
<span class="sd">        interpolation (OpenCV flag): flag that is used to specify the interpolation algorithm. Should be one of:</span>
<span class="sd">            cv2.INTER_NEAREST, cv2.INTER_LINEAR, cv2.INTER_CUBIC, cv2.INTER_AREA, cv2.INTER_LANCZOS4.</span>
<span class="sd">            Default: cv2.INTER_LINEAR.</span>
<span class="sd">        border_mode (OpenCV flag): flag that is used to specify the pixel extrapolation method. Should be one of:</span>
<span class="sd">            cv2.BORDER_CONSTANT, cv2.BORDER_REPLICATE, cv2.BORDER_REFLECT, cv2.BORDER_WRAP, cv2.BORDER_REFLECT_101.</span>
<span class="sd">            Default: cv2.BORDER_REFLECT_101</span>
<span class="sd">        value (int, float, list of int, list of float): padding value if border_mode is cv2.BORDER_CONSTANT.</span>
<span class="sd">        mask_value (int, float,</span>
<span class="sd">                    list of int,</span>
<span class="sd">                    list of float): padding value if border_mode is cv2.BORDER_CONSTANT applied for masks.</span>
<span class="sd">        shift_limit_x ((float, float) or float): shift factor range for width. If it is set then this value</span>
<span class="sd">            instead of shift_limit will be used for shifting width.  If shift_limit_x is a single float value,</span>
<span class="sd">            the range will be (-shift_limit_x, shift_limit_x). Absolute values for lower and upper bounds should lie in</span>
<span class="sd">            the range [0, 1]. Default: None.</span>
<span class="sd">        shift_limit_y ((float, float) or float): shift factor range for height. If it is set then this value</span>
<span class="sd">            instead of shift_limit will be used for shifting height.  If shift_limit_y is a single float value,</span>
<span class="sd">            the range will be (-shift_limit_y, shift_limit_y). Absolute values for lower and upper bounds should lie</span>
<span class="sd">            in the range [0, 1]. Default: None.</span>
<span class="sd">        rotate_method (str): rotation method used for the bounding boxes. Should be one of "largest_box" or "ellipse".</span>
<span class="sd">            Default: "largest_box"</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, keypoints, bboxes</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">shift_limit</span><span class="p">:</span> <span class="n">ScaleFloatType</span> <span class="o">=</span> <span class="mf">0.0625</span><span class="p">,</span>
        <span class="n">scale_limit</span><span class="p">:</span> <span class="n">ScaleFloatType</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="n">rotate_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="n">border_mode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">BORDER_REFLECT_101</span><span class="p">,</span>
        <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mask_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">shift_limit_x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScaleFloatType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">shift_limit_y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScaleFloatType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rotate_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"largest_box"</span><span class="p">,</span>
        <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit_x</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">shift_limit_x</span> <span class="k">if</span> <span class="n">shift_limit_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">shift_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit_y</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">shift_limit_y</span> <span class="k">if</span> <span class="n">shift_limit_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">shift_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_limit</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">scale_limit</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_limit</span> <span class="o">=</span> <span class="n">to_tuple</span><span class="p">(</span><span class="n">rotate_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span> <span class="o">=</span> <span class="n">border_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span> <span class="o">=</span> <span class="n">mask_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_method</span> <span class="o">=</span> <span class="n">rotate_method</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"largest_box"</span><span class="p">,</span> <span class="s2">"ellipse"</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Rotation method </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_method</span><span class="si">}</span><span class="s2"> is not valid."</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">shift_scale_rotate</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">shift_scale_rotate</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">cols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeypointInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">keypoint_shift_scale_rotate</span><span class="p">(</span><span class="n">keypoint</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"angle"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_limit</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s2">"scale"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_limit</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s2">"dx"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_limit_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit_x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="s2">"dy"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_limit_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit_y</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span> <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">bbox_shift_scale_rotate</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_method</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"shift_limit_x"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit_x</span><span class="p">,</span>
            <span class="s2">"shift_limit_y"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_limit_y</span><span class="p">,</span>
            <span class="s2">"scale_limit"</span><span class="p">:</span> <span class="n">to_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_limit</span><span class="p">,</span> <span class="n">bias</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">),</span>
            <span class="s2">"rotate_limit"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_limit</span><span class="p">,</span>
            <span class="s2">"interpolation"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="s2">"border_mode"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_mode</span><span class="p">,</span>
            <span class="s2">"value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">"mask_value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_value</span><span class="p">,</span>
            <span class="s2">"rotate_method"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_method</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="Transpose" id="albumentations.augmentations.geometric.transforms.Transpose">
<code>class <strong>
Transpose</strong></code>
<code>


    (always_apply=False, p=0.5)


                </code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L1416" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.Transpose" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Transpose the input by swapping rows and columns.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>p</code></td>
<td><code>float</code></td>
<td><p>probability of applying the transform. Default: 0.5.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, bboxes, keypoints</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Transpose</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Transpose the input by swapping rows and columns.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, bboxes, keypoints</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">always_apply</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">always_apply</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">bbox_transpose</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeypointInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">keypoint_transpose</span><span class="p">(</span><span class="n">keypoint</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[()]:</span>
        <span class="k">return</span> <span class="p">()</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" data-toc-label="VerticalFlip" id="albumentations.augmentations.geometric.transforms.VerticalFlip">
<code>class <strong>
VerticalFlip</strong></code>
<code>
</code> <span class="doc-github-link">
<a href="https://github.com/albumentations-team/albumentations/blob/master/albumentations/augmentations/geometric/transforms.py#L1315" target="_blank">[view source on GitHub]</a>
</span><a class="headerlink" href="#albumentations.augmentations.geometric.transforms.VerticalFlip" title="Permanent link">¶</a>
</h2>
<div class="class-signature">
</div>
<div class="doc doc-contents">
<p>Flip the input vertically around the x-axis.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>p</code></td>
<td><code>float</code></td>
<td><p>probability of applying the transform. Default: 0.5.</p></td>
</tr>
</tbody>
</table> <div class="admonition targets">
<p class="admonition-title">Targets</p>
<p>image, mask, bboxes, keypoints</p>
</div>
<p>Image types:
    uint8, float32</p>
<details class="quote">
<summary>Source code in <code>albumentations/augmentations/geometric/transforms.py</code></summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">VerticalFlip</span><span class="p">(</span><span class="n">DualTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Flip the input vertically around the x-axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float): probability of applying the transform. Default: 0.5.</span>

<span class="sd">    Targets:</span>
<span class="sd">        image, mask, bboxes, keypoints</span>

<span class="sd">    Image types:</span>
<span class="sd">        uint8, float32</span>

<span class="sd">    """</span>

    <span class="n">_targets</span> <span class="o">=</span> <span class="p">(</span><span class="n">Targets</span><span class="o">.</span><span class="n">IMAGE</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">MASK</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">BBOXES</span><span class="p">,</span> <span class="n">Targets</span><span class="o">.</span><span class="n">KEYPOINTS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">vflip</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="p">:</span> <span class="n">BoxInternalType</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BoxInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">bbox_vflip</span><span class="p">(</span><span class="n">bbox</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_to_keypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keypoint</span><span class="p">:</span> <span class="n">KeypointInternalType</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">KeypointInternalType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">F</span><span class="o">.</span><span class="n">keypoint_vflip</span><span class="p">(</span><span class="n">keypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_transform_init_args_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[()]:</span>
        <span class="k">return</span> <span class="p">()</span>
</code></pre></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
</div>
</div>
</div>


              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="footer.title">
      
        <a href="../rotate/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Rotation transforms (augmentations.geometric.functional)
            </div>
          </div>
        </a>
      
      
        <a href="../../mixing/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Index
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  

</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.top", "navigation.sections"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../../../js/extra.js"></script>
      
    
  </body>
</html>